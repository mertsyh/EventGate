@model EventDeneme.Models.users
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/Content/profile.css">
<section class="profile-section">
    <div class="profile-box">

        <div class="toggle-buttons">
            <button id="profileBtn" class="active">Profile</button>
            <button id="passwordBtn">Change Password</button>
            <button id="mytickets">My Tickets</button>
            <button id="refunds">Refund Requests</button>
        </div>

        <div id="profileContent">
            <h1>Account Information</h1>

            @using (Html.BeginForm("UpdateProfile", "Profile", FormMethod.Post))
            {
                <label>First Name</label>
                <input type="text" name="Name" value="@Model.name" required>

                <label>Last Name</label>
                <input type="text" name="Surname" value="@Model.surname" required>

                <label>Email</label>
                <input type="email" value="@Model.email" disabled>

                <label>Phone</label>
                <input type="text" value="@Model.phone" disabled>

                <div class="form-buttons">
                    <button type="submit">Save Changes</button>
                    <a href="/Register/Logout" class="btn-primary">Logout</a>
                </div>

            }
            @if (TempData["ProfileSuccess"] != null)
            {
                <p style="margin-top:15px;">
                    @TempData["ProfileSuccess"]
                </p>
            }

        </div>
        <div id="passwordContent" class="hidden">
            @using (Html.BeginForm("ChangePassword", "Profile", FormMethod.Post))
            {
                <h1>Change Password</h1>
                <label>Old Password*</label>
                <input type="password" name="OldPassword" required>

                <label>New Password*</label>
                <input type="password" name="NewPassword" required>

                <label>New Password (repeat)</label>
                <input type="password" name="ConfirmPassword" required>

                <div class="form-buttons">
                    <button type="submit">Update</button>
                </div>
            }
        </div>
        <div id="ticketsContent" class="hidden">
            <h1>My Tickets</h1>
            <p>Your tickets will be listed here.</p>
        </div>

        <div id="refundsContent" class="hidden">
            <h1>Refund Requests</h1>
            <p>Your refund requests will be listed here.</p>
        </div>

    </div>
</section>

<script>
    const profileBtn = document.getElementById('profileBtn');
    const passwordBtn = document.getElementById('passwordBtn');
    const myTicketsBtn = document.getElementById('mytickets');
    const refundsBtn = document.getElementById('refunds');

    const profileContent = document.getElementById('profileContent');
    const passwordContent = document.getElementById('passwordContent');
    const refundsContent = document.getElementById('refundsContent');
    const ticketsContent = document.getElementById('ticketsContent');

    function hideAll() {
        profileContent.classList.add("hidden");
        passwordContent.classList.add("hidden");
        refundsContent.classList.add("hidden");
        ticketsContent.classList.add("hidden");

        profileBtn.classList.remove("active");
        passwordBtn.classList.remove("active");
        myTicketsBtn.classList.remove("active");
        refundsBtn.classList.remove("active");
    }

    profileBtn.addEventListener('click', () => {
        hideAll();
        profileContent.classList.remove("hidden");
        profileBtn.classList.add("active");
        history.pushState(null, '', '/Profile');
    });

    passwordBtn.addEventListener('click', () => {
        hideAll();
        passwordContent.classList.remove("hidden");
        passwordBtn.classList.add("active");
        history.pushState(null, '', '/Profile/ChangePassword');
    });

    refundsBtn.addEventListener('click', () => {
        hideAll();
        refundsContent.classList.remove("hidden");
        refundsBtn.classList.add("active");
        history.pushState(null, '', '/Profile/Refunds');
    });

    /* 🔥 MY TICKETS – URL CHANGES, PAGE STAYS */
    myTicketsBtn.addEventListener('click', () => {
        hideAll();
        ticketsContent.classList.remove("hidden");
        myTicketsBtn.classList.add("active");
        history.pushState(null, '', '/Profile/MyTickets');
    });

    /* 🔄 BACK / FORWARD SUPPORT */
    window.addEventListener('popstate', () => {
        const path = window.location.pathname;

        hideAll();

        if (path.includes('MyTickets')) {
            ticketsContent.classList.remove("hidden");
            myTicketsBtn.classList.add("active");
        } else if (path.includes('ChangePassword')) {
            passwordContent.classList.remove("hidden");
            passwordBtn.classList.add("active");
        } else if (path.includes('Refunds')) {
            refundsContent.classList.remove("hidden");
            refundsBtn.classList.add("active");
        } else {
            profileContent.classList.remove("hidden");
            profileBtn.classList.add("active");
        }
    });
    document.addEventListener("DOMContentLoaded", function () {
    if ('@ViewBag.DefaultTab' === 'MyTickets') {
        document.getElementById('mytickets').click();
    }
});

</script>

