@model EventDeneme.Models.CheckoutViewModel
@{
    ViewBag.Title = "Checkout - " + Model.EventTitle;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        * {
            box-sizing: border-box;
        }

        .checkout-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            overflow-x: hidden;
        }

        .checkout-header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 0;
            margin-bottom: 30px;
        }

        .checkout-header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            color: #e7004c;
            font-size: 28px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: bold;
            color: #111;
        }

        .secure-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f6f7f8;
            border-radius: 9999px;
        }

        .secure-badge i {
            color: #10b981;
            font-size: 18px;
        }

        .secure-badge span {
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
        }

        .breadcrumbs {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            font-size: 14px;
            color: #6b7280;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #6b7280;
        }

        .breadcrumb-item.active {
            color: #e7004c;
            font-weight: bold;
        }

        .breadcrumb-separator {
            color: #d1d5db;
        }

        .checkout-content {
            display: flex;
            gap: 32px;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .checkout-form-section {
            flex: 1;
            min-width: 300px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .checkout-summary-section {
            width: 380px;
            flex-shrink: 0;
            max-width: 100%;
        }

        .form-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            width: 100%;
            overflow-x: hidden;
        }

        .form-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(231, 0, 76, 0.1);
            color: #e7004c;
            font-weight: bold;
            font-size: 14px;
        }

        .form-card-title {
            font-size: 18px;
            font-weight: bold;
            color: #111;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .form-input-wrapper {
            position: relative;
            width: 100%;
            max-width: 100%;
        }

        .form-input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 20px;
        }

        .form-input {
            width: 100%;
            height: 48px;
            padding: 12px 16px;
            padding-left: 48px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: white;
            box-sizing: border-box;
            max-width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: #e7004c;
            box-shadow: 0 0 0 3px rgba(231, 0, 76, 0.1);
        }

        .form-input.without-icon {
            padding-left: 16px;
        }

        .form-input.center {
            text-align: center;
        }

        .form-input.uppercase {
            text-transform: uppercase;
        }

        .form-input.mono {
            font-family: monospace;
        }

        .form-help-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .field-validation-error {
            color: #dc2626;
            font-size: 12px;
            margin-top: 4px;
        }

        .payment-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
            width: 100%;
            -webkit-overflow-scrolling: touch;
        }

        .payment-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .payment-tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .payment-tabs::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .payment-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .payment-tab.active {
            background: rgba(231, 0, 76, 0.1);
            border-color: #e7004c;
            color: #e7004c;
        }

        .payment-tab:hover {
            background: #f3f4f6;
        }

        .payment-tab i {
            font-size: 20px;
        }

        .card-brand {
            display: flex;
            align-items: center;
            gap: 4px;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            z-index: 1;
        }

        .card-brand-icon {
            width: 32px;
            height: 20px;
            background: #e5e7eb;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #6b7280;
            font-weight: bold;
        }

        .card-security-icon {
            color: #10b981;
            font-size: 18px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-top: 8px;
        }

        .checkbox-input {
            width: 20px;
            height: 20px;
            accent-color: #e7004c;
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 14px;
            color: #6b7280;
            cursor: pointer;
        }

        .summary-sticky-container {
            position: sticky;
            top: 100px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
        }

        .summary-header-image {
            height: 128px;
            width: 100%;
            position: relative;
            background: #e5e7eb;
            overflow: hidden;
        }

        .summary-header-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .summary-header-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
        }

        .summary-header-content {
            position: absolute;
            bottom: 12px;
            left: 16px;
            color: white;
        }

        .summary-category-badge {
            font-size: 12px;
            font-weight: 500;
            background: #e7004c;
            padding: 4px 8px;
            border-radius: 4px;
            margin-bottom: 4px;
            display: inline-block;
        }

        .summary-event-title {
            font-weight: bold;
            font-size: 18px;
            line-height: 1.2;
        }

        .summary-body {
            padding: 24px;
        }

        .summary-detail-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding-bottom: 16px;
            border-bottom: 1px dashed #e5e7eb;
            margin-bottom: 16px;
        }

        .summary-detail-icon {
            background: #f3f4f6;
            padding: 8px;
            border-radius: 8px;
            color: #e7004c;
        }

        .summary-detail-icon i {
            font-size: 20px;
        }

        .summary-detail-content {
            flex: 1;
        }

        .summary-detail-title {
            font-size: 14px;
            font-weight: 600;
            color: #111;
            margin-bottom: 4px;
        }

        .summary-detail-text {
            font-size: 12px;
            color: #6b7280;
        }

        .summary-ticket-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .summary-ticket-info {
            display: flex;
            flex-direction: column;
        }

        .summary-ticket-name {
            font-weight: 500;
            color: #111;
        }

        .summary-ticket-quantity {
            font-size: 12px;
            color: #6b7280;
        }

        .summary-ticket-price {
            font-weight: 600;
            color: #111;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 16px 0;
            border-top: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .summary-total-label {
            display: flex;
            flex-direction: column;
        }

        .summary-total-text {
            font-size: 14px;
            color: #6b7280;
        }

        .summary-total-note {
            font-size: 12px;
            color: #10b981;
            font-weight: 500;
        }

        .summary-total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #e7004c;
        }

        .submit-button {
            width: 100%;
            height: 48px;
            background: #e7004c;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(231, 0, 76, 0.2);
        }

        .submit-button:hover {
            background: #c5003f;
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(231, 0, 76, 0.3);
        }

        .submit-button:active {
            transform: translateY(0);
        }

        .submit-button i {
            font-size: 18px;
            transition: transform 0.2s;
        }

        .submit-button:hover i {
            transform: translateX(4px);
        }

        .trust-message {
            margin-top: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            color: #9ca3af;
            font-size: 11px;
            text-align: center;
        }

        .trust-message i {
            font-size: 16px;
        }

        .timer-card {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            width: 100%;
            box-sizing: border-box;
        }

        .timer-icon {
            color: #f97316;
            margin-top: 2px;
            font-size: 18px;
            flex-shrink: 0;
        }

        .timer-content {
            flex: 1;
            min-width: 0;
        }

        .timer-title {
            font-size: 14px;
            font-weight: 600;
            color: #c2410c;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .timer-text {
            font-size: 12px;
            color: #9a3412;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .timer-display {
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            color: #c2410c;
        }

        @@media (max-width: 1024px) {
            .checkout-container {
                padding: 16px;
            }

            .checkout-summary-section {
                width: 100%;
                max-width: 100%;
            }

            .summary-sticky-container {
                position: static;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .checkout-content {
                gap: 24px;
            }
        }

        @@media (max-width: 768px) {
            .checkout-container {
                padding: 12px;
            }

            .checkout-content {
                flex-direction: column;
                gap: 20px;
            }

            .checkout-header-content {
                flex-direction: column;
                gap: 12px;
                padding: 0 12px;
            }

            .secure-badge {
                display: none;
            }

            .breadcrumbs {
                display: none;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .form-card {
                padding: 20px;
            }

            .checkout-form-section {
                min-width: 100%;
            }

            .payment-tabs {
                gap: 12px;
            }

            .payment-tab {
                padding: 10px 16px;
                font-size: 14px;
            }
        }

        @@media (max-width: 480px) {
            .checkout-container {
                padding: 8px;
            }

            .form-card {
                padding: 16px;
            }

            .summary-body {
                padding: 16px;
            }

            .form-input {
                font-size: 16px; /* iOS zoom önleme */
            }

            .timer-card {
                padding: 10px;
                margin-top: 16px;
            }

            .timer-title {
                font-size: 13px;
            }

            .timer-text {
                font-size: 11px;
            }

            .summary-detail-item {
                padding-bottom: 12px;
                margin-bottom: 12px;
            }

            .summary-total {
                padding: 12px 0;
                margin-bottom: 16px;
            }
        }
    </style>
}

<div class="checkout-header">
    <div class="checkout-header-content">
        <div class="logo-section">
            <i class="fas fa-ticket-alt logo-icon"></i>
            <span class="logo-text">EventGate</span>
        </div>
        <div class="secure-badge">
            <i class="fas fa-lock"></i>
            <span>Secure Payment 256-bit SSL</span>
        </div>
    </div>
</div>

<div class="checkout-container">
    <nav class="breadcrumbs">
        <div class="breadcrumb-item">
            <i class="fas fa-check-circle"></i>
            <span>Seat Selection</span>
        </div>
        <span class="breadcrumb-separator">/</span>
        <div class="breadcrumb-item active">
            <span class="step-number" style="width: 20px; height: 20px; font-size: 12px;">2</span>
            <span>Payment</span>
        </div>
        <span class="breadcrumb-separator">/</span>
        <div class="breadcrumb-item" style="color: #9ca3af;">
            <span>Confirmation</span>
        </div>
    </nav>

    <div class="checkout-content">
        
        <div class="checkout-form-section">
            @using (Html.BeginForm("ProcessPayment", "Ticket", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.PerformanceId)
                @Html.HiddenFor(m => m.SelectedSeatIds)
                @Html.HiddenFor(m => m.TotalAmount)

                
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="step-number">1</div>
                        <h3 class="form-card-title">Contact Information</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            @Html.LabelFor(m => m.FullName, new { @class = "form-label" })
                            @Html.TextBoxFor(m => m.FullName, new { @class = "form-input without-icon", placeholder = "Full Name" })
                            @Html.ValidationMessageFor(m => m.FullName, "", new { @class = "field-validation-error" })
                        </div>
                        <div class="form-group full-width">
                            @Html.LabelFor(m => m.Email, new { @class = "form-label" })
                            <div class="form-input-wrapper">
                                <i class="fas fa-envelope form-input-icon"></i>
                                @Html.TextBoxFor(m => m.Email, new { @class = "form-input", type = "email", placeholder = "example@email.com" })
                            </div>
                            @Html.ValidationMessageFor(m => m.Email, "", new { @class = "field-validation-error" })
                            <p class="form-help-text">Your tickets will be sent to this address.</p>
                        </div>
                        <div class="form-group full-width">
                            @Html.LabelFor(m => m.Phone, new { @class = "form-label" })
                            @Html.TextBoxFor(m => m.Phone, new { @class = "form-input without-icon", placeholder = "0555 123 45 67" })
                            @Html.ValidationMessageFor(m => m.Phone, "", new { @class = "field-validation-error" })
                        </div>
                    </div>
                </div>

                
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="step-number">2</div>
                        <h3 class="form-card-title">Payment Method</h3>
                    </div>


                    <div class="form-grid">
                        <div class="form-group full-width">
                            @Html.LabelFor(m => m.CardNumber, new { @class = "form-label" })
                            <div class="form-input-wrapper">
                                <i class="fas fa-credit-card form-input-icon"></i>
                                @Html.TextBoxFor(m => m.CardNumber, new { @class = "form-input mono", id = "CardNumber", placeholder = "0000 0000 0000 0000" })
                                <div class="card-brand">
                                    <div class="card-brand-icon">VISA</div>
                                    <i class="fas fa-lock card-security-icon"></i>
                                </div>
                            </div>
                            @Html.ValidationMessageFor(m => m.CardNumber, "", new { @class = "field-validation-error" })
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ExpiryDate, new { @class = "form-label" })
                            @Html.TextBoxFor(m => m.ExpiryDate, new { @class = "form-input without-icon center", id = "ExpiryDate", placeholder = "MM/YY" })
                            @Html.ValidationMessageFor(m => m.ExpiryDate, "", new { @class = "field-validation-error" })
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(m => m.CVV, new { @class = "form-label" })
                            <div style="display: flex; align-items: center; gap: 4px;">
                                @Html.TextBoxFor(m => m.CVV, new { @class = "form-input without-icon center", id = "CVV", placeholder = "123" })
                                <i class="fas fa-question-circle" style="color: #9ca3af; font-size: 14px; cursor: help;" title="3-digit code on the back of your card"></i>
                            </div>
                            @Html.ValidationMessageFor(m => m.CVV, "", new { @class = "field-validation-error" })
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label" for="CardName">Name on Card</label>
                            <input type="text" id="CardName" class="form-input without-icon uppercase" placeholder="FULL NAME" />
                        </div>
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="saveCard" class="checkbox-input" />
                        <label for="saveCard" class="checkbox-label">Securely save my card for future purchases</label>
                    </div>

                    <button type="submit" class="submit-button" id="submitBtn" style="margin-top: 24px;">
                        <span>Complete Payment</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            }
        </div>

        
        <div class="checkout-summary-section">
            <div class="summary-sticky-container">
                <div class="summary-card">
                    <div class="summary-header-image">
                        <img src="@Url.Content(Model.EventImageUrl ?? "~/images/login_background.png")" alt="@Model.EventTitle" />
                        <div class="summary-header-overlay"></div>
                        <div class="summary-header-content">
                            @if (!string.IsNullOrEmpty(Model.CategoryName))
                            {
                                <span class="summary-category-badge">@Model.CategoryName</span>
                            }
                            <h3 class="summary-event-title">@Model.EventTitle</h3>
                        </div>
                    </div>
                    <div class="summary-body">
                        @if (Model.EventDate.HasValue)
                        {
                            <div class="summary-detail-item">
                                <div class="summary-detail-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="summary-detail-content">
                                    <div class="summary-detail-title">@Model.EventDate.Value.ToString("MMMM dd, yyyy")</div>
                                    <div class="summary-detail-text">@Model.EventDate.Value.ToString("dddd") • @Model.EventDate.Value.ToString("hh:mm tt")</div>
                                    @if (!string.IsNullOrEmpty(Model.VenueName))
                                    {
                                        <div class="summary-detail-text" style="margin-top: 4px;">
                                            <i class="fas fa-map-marker-alt" style="font-size: 12px;"></i>
                                            @Model.VenueName@(!string.IsNullOrEmpty(Model.CityName) ? ", " + Model.CityName : "")
                                        </div>
                                    }
                                </div>
                            </div>
                        }

                        <div style="margin-bottom: 16px;">
                            <div class="summary-ticket-item">
                                <div class="summary-ticket-info">
                                    <span class="summary-ticket-name">Ticket</span>
                                    <span class="summary-ticket-quantity">x @Model.SeatCount @(Model.SeatCount == 1 ? "Item" : "Items")</span>
                                </div>
                                <span class="summary-ticket-price">@Model.TotalAmount.ToString("N2") ₺</span>
                            </div>
                        </div>

                        <div class="summary-total">
                            <div class="summary-total-label">
                                <span class="summary-total-text">Total Amount</span>
                                <span class="summary-total-note">Taxes Included</span>
                            </div>
                            <div class="summary-total-amount">@Model.TotalAmount.ToString("N2") ₺</div>
                        </div>

                        <div class="trust-message">
                            <i class="fas fa-lock"></i>
                            <span>Your payment information is protected by 256-bit SSL certificate.</span>
                        </div>
                    </div>
                </div>

                <div class="timer-card">
                    <i class="fas fa-exclamation-circle timer-icon"></i>
                    <div class="timer-content">
                        <div class="timer-title">Time is running out!</div>
                        <div class="timer-text">
                            Time remaining to reserve your tickets: <span class="timer-display" id="timer">15:00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        
        $('form').attr('id', 'checkoutForm');

        
        var minutes = 15;
        var seconds = 0;
        var timer = setInterval(function() {
            if (seconds === 0) {
                if (minutes === 0) {
                    clearInterval(timer);
                    alert('Your time has expired! Please try again.');
                    window.location.href = '@Url.Action("Index", "Event")';
                    return;
                }
                minutes--;
                seconds = 59;
            } else {
                seconds--;
            }
            var display = (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
            $('#timer').text(display);
        }, 1000);

        
        $('#CardNumber').on('input', function () {
            var value = $(this).val().replace(/\s/g, '');
            var formatted = value.match(/.{1,4}/g)?.join(' ') || value;
            if (formatted.length <= 19) {
                $(this).val(formatted);
            }
        });

        
        $('#CardNumber').on('keypress', function (e) {
            var char = String.fromCharCode(e.which);
            if (!/[0-9\s]/.test(char)) {
                e.preventDefault();
            }
        });

        
        $('#ExpiryDate').on('input', function () {
            var value = $(this).val().replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            $(this).val(value);
        });

        
        $('#ExpiryDate').on('keypress', function (e) {
            var char = String.fromCharCode(e.which);
            if (!/[0-9\/]/.test(char)) {
                e.preventDefault();
            }
        });

        
        $('#CVV').on('input', function () {
            $(this).val($(this).val().replace(/\D/g, ''));
            if ($(this).val().length > 4) {
                $(this).val($(this).val().substring(0, 4));
            }
        });

        
        $('#CVV').on('keypress', function (e) {
            var char = String.fromCharCode(e.which);
            if (!/[0-9]/.test(char)) {
                e.preventDefault();
            }
        });

        
        $('#Phone').on('input', function () {
            $(this).val($(this).val().replace(/[^\d\+\-\(\)\s]/g, ''));
        });

        
        $('#checkoutForm').on('submit', function (e) {
            var isValid = true;
            var errors = [];

            
            var fullName = $('#FullName').val().trim();
            var nameWords = fullName.split(/\s+/).filter(function(word) { return word.length > 0; });
            if (nameWords.length < 2) {
                isValid = false;
                errors.push('Full name must contain at least 2 words');
                $('#FullName').css('border-color', '#dc2626');
            } else {
                var nameValid = true;
                for (var i = 0; i < nameWords.length; i++) {
                    if (!/^[a-zA-ZçğıöşüÇĞIİÖŞÜ]{2,}$/.test(nameWords[i])) {
                        nameValid = false;
                        break;
                    }
                }
                if (!nameValid) {
                    isValid = false;
                    errors.push('Full name must contain only letters');
                    $('#FullName').css('border-color', '#dc2626');
                } else {
                    $('#FullName').css('border-color', '');
                }
            }

            
            var cardNumber = $('#CardNumber').val().replace(/\s/g, '');
            if (!/^\d{13,19}$/.test(cardNumber)) {
                isValid = false;
                errors.push('Card number must be 13-19 digits');
                $('#CardNumber').css('border-color', '#dc2626');
            } else {
                
                if (!validateLuhn(cardNumber)) {
                    isValid = false;
                    errors.push('Invalid card number (Luhn check failed)');
                    $('#CardNumber').css('border-color', '#dc2626');
                } else {
                    $('#CardNumber').css('border-color', '');
                }
            }

            
            var cvv = $('#CVV').val();
            if (!/^\d{3,4}$/.test(cvv)) {
                isValid = false;
                errors.push('CVV must be 3 or 4 digits');
                $('#CVV').css('border-color', '#dc2626');
            } else {
                $('#CVV').css('border-color', '');
            }

            
            var expiryDate = $('#ExpiryDate').val();
            if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
                isValid = false;
                errors.push('Expiry date must be in MM/YY format');
                $('#ExpiryDate').css('border-color', '#dc2626');
            } else {
                var parts = expiryDate.split('/');
                var month = parseInt(parts[0]);
                var year = parseInt(parts[1]);
                var fullYear = 2000 + year;
                var expiry = new Date(fullYear, month, 0);
                var today = new Date();
                today.setHours(0, 0, 0, 0);

                if (month < 1 || month > 12) {
                    isValid = false;
                    errors.push('Invalid month (must be 01-12)');
                    $('#ExpiryDate').css('border-color', '#dc2626');
                } else if (expiry < today) {
                    isValid = false;
                    errors.push('Card has expired');
                    $('#ExpiryDate').css('border-color', '#dc2626');
                } else {
                    $('#ExpiryDate').css('border-color', '');
                }
            }

            
            var phone = $('#Phone').val().replace(/[\s\-\(\)]/g, '');
            if (phone.startsWith('+90')) {
                phone = phone.substring(3);
            } else if (phone.startsWith('0')) {
                phone = phone.substring(1);
            }
            if (!/^\d{10}$/.test(phone)) {
                isValid = false;
                errors.push('Invalid phone number format');
                $('#Phone').css('border-color', '#dc2626');
            } else {
                $('#Phone').css('border-color', '');
            }

            if (!isValid) {
                e.preventDefault();
                alert('Please fix the following errors:\n' + errors.join('\n'));
                return false;
            }

            return true;
        });

        
        function validateLuhn(cardNumber) {
            var sum = 0;
            var alternate = false;

            for (var i = cardNumber.length - 1; i >= 0; i--) {
                var n = parseInt(cardNumber[i]);

                if (alternate) {
                    n *= 2;
                    if (n > 9) {
                        n -= 9;
                    }
                }

                sum += n;
                alternate = !alternate;
            }

            return (sum % 10 === 0);
        }

        
        $('#FullName, #CardNumber, #CVV, #ExpiryDate, #Phone').on('input', function () {
            if ($(this).css('border-color') === 'rgb(220, 38, 38)') {
                $(this).css('border-color', '');
            }
        });
    });
</script>


