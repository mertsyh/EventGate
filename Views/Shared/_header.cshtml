
<header>
    <a href="@Url.Action("Index","Home")">
        <img class="headerlogo" src="~/images/logo.png" alt="EventGate Logo" />
    </a>

    <div class="nav-right">

        <div class="SearchArea1">
            <div class="Search-area-main">
                <input type="text" id="txtSearch" placeholder="Search For Events, Artists..." />
            </div>
            <i class="fa-solid fa-magnifying-glass" id="btnSearch"></i>
        </div>

    </div>


    <ul>
        <li><i class="fa-solid fa-film"></i><a href="~/Event/Cinema">Cinema</a></li>
        <li><i class="fa-solid fa-music"></i><a href="~/Event/Music">Music</a></li>
        <li><i class="fa-solid fa-masks-theater"></i><a href="~/Event/Theater">Theater</a></li>

        <li>
            <a href="@Url.Action("Index", "Cart")" style="position: relative;">
                <i class="fa-solid fa-shopping-cart"></i>
                <span id="cart-count" style="position: absolute; top: -8px; right: -8px; background: #e7004c; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">0</span>
            </a>
        </li>

        <li class="user-menu">
            @if (Session["UserID"] != null)
            {
                <a href="@Url.Action("Index", "Profile")">
                    <i class="fa-solid fa-user"></i>
                    <i id="prof" class="fa-solid fa-angle-down fa-xs"></i>
                </a>


            }
            else
            {
                <a href="/Register/Signin">
                    <i class="fa-solid fa-user"></i>
                    <i id="prof" class="fa-solid fa-angle-down fa-xs"></i>
                </a>
            }


            <ul class="dropdown">

                @*  unsigned *@
                @if (Session["UserID"] == null)
                {
                    <li><a href="/Register/Signin">Sign in</a></li>
                }
                else
                {
                    @* signed *@
                    <li><a href="@Url.Action("Index", "Profile")">Profile</a></li>
                    <li><a href="@Url.Action("MyTickets", "Profile")">My Tickets</a></li>

                    <li><a href="/Register/Logout">Sign out</a></li>
                }

            </ul>
        </li>

    </ul>

    </div>
</header>
<script>
    document.addEventListener("DOMContentLoaded", function () {

    const btn = document.getElementById("btnSearch");
        const input = document.getElementById("txtSearch");

        if (!btn || !input) return;

        function runSearch() {
        const q = input.value.trim();
        if (q !== "") {
            window.location.href = "/Event/Search?q=" + encodeURIComponent(q);
        }
    }

        // Icon click
        btn.addEventListener("click", runSearch);

        // Enter key
        input.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            e.preventDefault();
        runSearch();
        }
    });

    // Load cart count on page load
    function loadCartCount() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '@Url.Action("GetCartCount", "Cart")', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        var cartCountEl = document.getElementById('cart-count');
                        if (cartCountEl) {
                            cartCountEl.textContent = data.itemCount || 0;
                            if (data.itemCount > 0) {
                                cartCountEl.style.display = 'flex';
                            } else {
                                cartCountEl.style.display = 'none';
                            }
                        }
                    } catch (e) {
                        console.error('Error parsing cart count response:', e);
                    }
                }
            }
        };
        xhr.send();
    }

    // Load cart count when page loads
    loadCartCount();
});

</script>
